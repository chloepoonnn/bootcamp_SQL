CREATE DATABASE ORG;

SHOW DATABASES;

USE ORG;

TRUNCATE TABLE WORKER;
TRUNCATE TABLE BONUS;

CREATE TABLE WORKER (
WORKER_ID INTEGER NOT NULL PRIMARY KEY AUTO_INCREMENT,
FIRST_NAME CHAR(25),
LAST_NAME CHAR (25),
SALARY NUMERIC(15),
JOINING_DATE DATETIME,
DEPARTMENT CHAR (25)
);
INSERT INTO WORKER
(FIRST_NAME, LAST_NAME, SALARY, JOINING_DATE, DEPARTMENT) VALUES
('Monika', 'Arora', 100000, '21-02-20 09:00:00', 'HR'),
('Niharika', 'Verma', 80000, '21-06-11 09:00:00', 'Admin'),
('Vishal', 'Singhal', 300000, '21-02-20 09:00:00', 'HR'),
('Mohan', 'Sarah', 300000, '12-03-19 09:00:00', 'Admin'),
('Amitabh', 'Singh', 500000, '21-02-20 09:00:00', 'Admin'),
('Vivek', 'Bhati', 490000, '21-06-11 09:00:00', 'Admin'),
('Vipul', 'Diwan', 200000, '21-06-11 09:00:00', 'Account'),
('Satish', 'Kumar', 75000, '21-01-20 09:00:00', 'Account'),
('Geetika', 'Chauhan', 90000, '21-04-11 09:00:00', 'Admin');
SELECT * FROM WORKER;


CREATE TABLE BONUS (
WORKER_REF_ID INTEGER, 
BONUS_AMOUNT NUMERIC(10), 
BONUS_DATE DATETIME, 
FOREIGN KEY (WORKER_REF_ID) REFERENCES Worker (WORKER_ID) 
);      
INSERT INTO BONUS
(WORKER_REF_ID, BONUS_AMOUNT, BONUS_DATE)
VALUES
 ('6', '32000', '2021-11-02'),
 ('6', '20000', '2022-11-02'),
 ('5', '21000', '2021-11-02'),
 ('9', '30000', '2021-11-02'),
 ('8', '4500', '2022-11-02');
SELECT * FROM BONUS;

SELECT SALARY AS SECOND_MAXIMUN_SALARY
FROM WORKER
ORDER BY SALARY DESC
LIMIT 1 OFFSET 1;

SELECT CONCAT(FIRST_NAME, ' ' ,LAST_NAME) AS NAME , MAX(SALARY), DEPARTMENT
FROM WORKER 
GROUP BY DEPARTMENT, CONCAT(FIRST_NAME, ' ' ,LAST_NAME);

SELECT CONCAT(W1.FIRST_NAME, ' ' ,W1.LAST_NAME) AS NAME , W1.SALARY
FROM WORKER w1
LEFT JOIN WORKER w2 ON w1.DEPARTMENT = w2.DEPARTMENT AND w1.SALARY < w2.SALARY
WHERE w2.DEPARTMENT IS NULL;

SELECT CONCAT(W1.FIRST_NAME, ' ' ,W1.LAST_NAME) AS NAME , W1.SALARY
FROM WORKER W1, WORKER W2
WHERE W1.SALARY = W2.SALARY
AND W1.WORKER_ID <> W2.WORKER_ID
GROUP BY CONCAT(W1.FIRST_NAME, ' ' ,W1.LAST_NAME), W2.SALARY;

SELECT * FROM BONUS;

SELECT CONCAT(W.FIRST_NAME, ' ', W.LAST_NAME) AS NAME, SUM(W.SALARY + B.BONUS_AMOUNT) AS TOTAL
FROM WORKER W, BONUS B
WHERE W.WORKER_ID = B.WORKER_REF_ID
AND YEAR(B.BONUS_DATE) = 2021
GROUP BY W.FIRST_NAME, W.LAST_NAME;

DELETE FROM WORKER;
DROP TABLE WORKER;